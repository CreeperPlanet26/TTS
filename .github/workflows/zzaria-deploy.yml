name: "Deploy: Zzaria"

on:
    push:
        branches:
            - master
        paths:
            - zzaria/**
            - yarn.lock
            - .github/workflows/zzaria-deploy.yml

jobs:
    deploy:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                  node-version: 14.x
                  
            - name: Install Deps
              run: yarn
              
            - name: Build Axeroni
              run: cd ./axeroni && yarn build    
              
            - name: Heroku login credentials
              run: |
                cat > ~/.netrc <<EOF
                 machine api.heroku.com
                   login $HEROKU_EMAIL
                   password $HEROKU_API_KEY
                machine git.heroku.com
                   login $HEROKU_EMAIL
                   password $HEROKU_API_KEY
                EOF
              env:
                HEROKU_API_KEY: ${{secrets.ZZARIA_API_KEY}}
                HEROKU_EMAIL: ${{secrets.ZZARIA_EMAIL}}
          
            - name: Add Heroku remote
              run: cd zzaria && heroku git:remote --app tts-api-prod
              env:
                 HEROKU_APP_NAME: ${{ secrets.HEROKU_APP_NAME }}
              
            - name: Push to Heroku
              run: cd zzaria && git push heroku master
